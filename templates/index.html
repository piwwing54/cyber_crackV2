
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Crack Pro v3.0 - System Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 1.5rem;
        }
        .status-indicator {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }
        .status-active {
            background-color: #28a745;
        }
        .status-inactive {
            background-color: #dc3545;
        }
        .metric-card {
            border-left: 0.25rem solid #4e73df;
        }
        .success-card {
            border-left: 0.25rem solid #28a745;
        }
        .warning-card {
            border-left: 0.25rem solid #ffc107;
        }
        .danger-card {
            border-left: 0.25rem solid #dc3545;
        }
        #botMessages {
            max-height: 300px;
            overflow-y: auto;
        }
        .process-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body id="page-top">
    <div id="wrapper">
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
            <h1 class="h3 mb-0 text-gray-800"><i class="fas fa-shield-alt me-2"></i>Cyber Crack Pro v3.0 - System Dashboard</h1>
        </nav>
        
        <div class="container-fluid">
            <!-- System Status Cards -->
            <div class="row">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card metric-card">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        Bot Status</div>
                                    <div class="row no-gutters align-items-center">
                                        <div class="col-auto">
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                <span class="status-indicator status-active"></span>
                                                Active
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-robot fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card success-card">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Completed Processes</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="completedCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card warning-card">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        Queue Length</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="queueCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-list fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card danger-card">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                        System Uptime</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="uptime">00:00:00</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-clock fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time status updates -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Real-Time Process Status</h6>
                        </div>
                        <div class="card-body">
                            <div class="progress mb-4">
                                <div class="progress-bar" id="overallProgress" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div id="currentProcessStatus">
                                <p>No active process</p>
                            </div>
                            <div id="processQueue">
                                <h5>Process Queue:</h5>
                                <div id="queueList"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">System Resources</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <span class="small">CPU Usage</span>
                                <div class="progress mb-2">
                                    <div id="cpuProgress" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="small" id="cpuPercent">0%</span>
                            </div>
                            
                            <div class="mb-3">
                                <span class="small">Memory Usage</span>
                                <div class="progress mb-2">
                                    <div id="memoryProgress" class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="small" id="memoryPercent">0%</span>
                            </div>
                            
                            <div class="mb-3">
                                <h5 class="small">Active Users</h5>
                                <p id="activeUsers" class="h4">0</p>
                            </div>
                            
                            <div class="mb-3">
                                <h5 class="small">Backend Status</h5>
                                <span class="status-indicator status-active"></span>
                                <span id="backendStatus">Running</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Bot Messages</h6>
                        </div>
                        <div class="card-body">
                            <div id="botMessages">
                                <p>Loading messages...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ws = new WebSocket('ws://localhost:8000/ws');
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            console.log('Received data:', data);
            
            if (data.type === 'system_update') {
                // Update system stats
                document.getElementById('cpuPercent').textContent = data.stats.cpu_usage + '%';
                document.getElementById('cpuProgress').style.width = data.stats.cpu_usage + '%';
                document.getElementById('cpuProgress').ariaValueNow = data.stats.cpu_usage;
                
                document.getElementById('memoryPercent').textContent = data.stats.memory_usage + '%';
                document.getElementById('memoryProgress').style.width = data.stats.memory_usage + '%';
                document.getElementById('memoryProgress').ariaValueNow = data.stats.memory_usage;
                
                document.getElementById('activeUsers').textContent = data.stats.active_users;
                document.getElementById('uptime').textContent = data.stats.uptime;
            }
            else if (data.type === 'process_update') {
                // Update process status
                document.getElementById('currentProcessStatus').innerHTML = 
                    `<p><strong>Processing:</strong> ${data.job.original_apk}</p>` +
                    `<p><strong>Type:</strong> ${data.job.operation_type}</p>`;
            }
            else if (data.type === 'process_step') {
                // Update progress
                document.getElementById('overallProgress').style.width = data.progress + '%';
                document.getElementById('overallProgress').ariaValueNow = data.progress;

                let phaseInfo = '';
                if (data.phase) {
                    phaseInfo = `<p><strong>Phase:</strong> ${data.phase}</p>`;
                }

                document.getElementById('currentProcessStatus').innerHTML =
                    `<p><strong>Step:</strong> ${data.step}</p>` +
                    phaseInfo +
                    `<p><strong>Progress:</strong> ${data.progress}%</p>`;
            }
            else if (data.type === 'process_complete') {
                // Update counter
                const completedCount = parseInt(document.getElementById('completedCount').textContent) + 1;
                document.getElementById('completedCount').textContent = completedCount;
                
                // Reset progress bar
                document.getElementById('overallProgress').style.width = '0%';
                document.getElementById('overallProgress').ariaValueNow = '0';
                
                document.getElementById('currentProcessStatus').innerHTML = 
                    `<p class="text-success"><strong>COMPLETED:</strong> ${data.job.original_apk}</p>`;
            }
            else if (data.type === 'new_process') {
                // Add to queue
                const queueCount = parseInt(document.getElementById('queueCount').textContent) + 1;
                document.getElementById('queueCount').textContent = queueCount;
                
                const queueItem = document.createElement('div');
                queueItem.className = 'process-item';
                queueItem.innerHTML = `<strong>New job:</strong> ${data.job.original_apk} (Type: ${data.job.operation_type})`;
                document.getElementById('queueList').appendChild(queueItem);
            }
            else {
                // Update counters for general status changes
                if (data.system_stats) {
                    document.getElementById('completedCount').textContent = data.system_stats.total_processed;
                    document.getElementById('uptime').textContent = data.system_stats.uptime;
                }
                
                if (data.bot_messages) {
                    const messagesDiv = document.getElementById('botMessages');
                    messagesDiv.innerHTML = '';
                    
                    // Show last 10 messages
                    const messagesToShow = data.bot_messages.slice(-10);
                    for (const msg of messagesToShow) {
                        const p = document.createElement('p');
                        p.className = 'small mb-1';
                        p.textContent = msg;
                        messagesDiv.appendChild(p);
                    }
                }
            }
        };
        
        ws.onopen = function(event) {
            console.log('WebSocket connected');
        };
        
        ws.onerror = function(error) {
            console.log('WebSocket error: ', error);
        };
        
        // Fetch initial status
        async function fetchInitialStatus() {
            const response = await fetch('/api/status');
            const status = await response.json();
            
            document.getElementById('completedCount').textContent = status.total_completed;
            document.getElementById('queueCount').textContent = status.process_queue_length;
            document.getElementById('uptime').textContent = status.system_uptime;
            document.getElementById('activeUsers').textContent = status.active_users;
        }
        
        fetchInitialStatus();
    </script>
</body>
</html>
